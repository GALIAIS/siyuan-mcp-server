# SiYuan MCP Server

ä¸€ä¸ªä¸ºæ€æºç¬”è®°ï¼ˆSiYuanï¼‰è®¾è®¡çš„ Model Context Protocol (MCP) æœåŠ¡å™¨ï¼Œæä¾›å®Œæ•´çš„ AI é›†æˆå’Œæ™ºèƒ½çŸ¥è¯†ç®¡ç†åŠŸèƒ½ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

### ç¬”è®°ç®¡ç†
- **ç¬”è®°æœ¬æ“ä½œ**: åˆ›å»ºã€åˆ—è¡¨ã€æ‰“å¼€ã€å…³é—­ã€é‡å‘½åã€åˆ é™¤ç¬”è®°æœ¬
- **æ–‡æ¡£ç®¡ç†**: åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤æ–‡æ¡£ï¼Œæ”¯æŒæ‰¹é‡æ“ä½œ
- **å—æ“ä½œ**: åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ç¬”è®°å—ï¼Œæ”¯æŒæ‰¹é‡æ“ä½œ
- **å—å±æ€§**: è®¾ç½®å’Œè·å–å—å±æ€§ï¼Œæ”¯æŒè‡ªå®šä¹‰å±æ€§ç®¡ç†

### æœç´¢åŠŸèƒ½
- **ç®€å•æœç´¢**: å¿«é€Ÿå…³é”®è¯æœç´¢
- **é€’å½’æœç´¢**: æ·±åº¦å†…å®¹æŒ–æ˜ï¼Œæ”¯æŒå±‚çº§éå†
- **æ–‡æ¡£å†…æœç´¢**: åœ¨æŒ‡å®šæ–‡æ¡£ä¸­ç²¾ç¡®æŸ¥æ‰¾
- **æ‰¹é‡è¯»å–**: é«˜æ•ˆæ‰¹é‡è¯»å–å¤šä¸ªæ–‡æ¡£

### æ¨¡æ¿ä¸æ¸²æŸ“
- **æ¨¡æ¿æ¸²æŸ“**: æ”¯æŒæ ‡å‡†æ¨¡æ¿è¯­æ³•
- **Sprigæ¨¡æ¿**: æ”¯æŒSprigå‡½æ•°åº“çš„é«˜çº§æ¨¡æ¿åŠŸèƒ½
- **åŠ¨æ€å†…å®¹**: åŸºäºæ¨¡æ¿ç”Ÿæˆæ ¼å¼åŒ–å†…å®¹

### å¯¼å‡ºåŠŸèƒ½
- **Markdownå¯¼å‡º**: å¯¼å‡ºä¸ºæ ‡å‡†Markdownæ ¼å¼
- **å¤šæ ¼å¼å¯¼å‡º**: æ”¯æŒPDFã€Wordã€HTMLç­‰å¤šç§æ ¼å¼
- **æ ‘çŠ¶ç»“æ„å¯¼å‡º**: ä¿ç•™æ–‡æ¡£å±‚çº§å…³ç³»çš„JSONå¯¼å‡º

### èµ„æºç®¡ç†
- **æ–‡ä»¶ä¸Šä¼ **: ä¸Šä¼ å›¾ç‰‡ã€æ–‡æ¡£ç­‰èµ„æºæ–‡ä»¶
- **èµ„æºåˆ—è¡¨**: åˆ—å‡ºæ–‡æ¡£ä¸­çš„æ‰€æœ‰èµ„æº
- **èµ„æºé‡å‘½å**: é‡å‘½åèµ„æºæ–‡ä»¶
- **OCRè¯†åˆ«**: å›¾ç‰‡æ–‡å­—è¯†åˆ«åŠŸèƒ½

### æ•°æ®æ“ä½œ
- **SQLæŸ¥è¯¢**: æ‰§è¡ŒSQLæŸ¥è¯¢ï¼Œæ”¯æŒå¤æ‚çš„æ•°æ®æ£€ç´¢
- **æ–‡ä»¶æ“ä½œ**: è¯»å–ã€å†™å…¥ã€åˆ é™¤æ–‡ä»¶
- **æ–‡ä»¶åˆ—è¡¨**: åˆ—å‡ºç›®å½•ä¸­çš„æ–‡ä»¶

### ç³»ç»Ÿå·¥å…·
- **æ—¶é—´è·å–**: è·å–å½“å‰çœŸå®æ—¶é—´ï¼Œæ”¯æŒå¤šç§æ ¼å¼å’Œæ—¶åŒº
- **å¥åº·æ£€æŸ¥**: ç³»ç»Ÿå¥åº·çŠ¶æ€ç›‘æ§
- **ç«¯å£å‘ç°**: è‡ªåŠ¨å‘ç°æ€æºç¬”è®°å¯ç”¨ç«¯å£

### AI æ™ºèƒ½é›†æˆ
- **æ™ºèƒ½å·¥å…·é€‰æ‹©**: AIé©±åŠ¨çš„å·¥å…·æ¨èå’Œé€‰æ‹©
- **ä½¿ç”¨åœºæ™¯æŒ‡å¯¼**: è¯¦ç»†çš„å·¥å…·ä½¿ç”¨åœºæ™¯å’Œç¤ºä¾‹
- **æ€§èƒ½ä¼˜åŒ–å»ºè®®**: åŸºäºä½¿ç”¨æ¨¡å¼çš„ä¼˜åŒ–å»ºè®®
- **é”™è¯¯å¤„ç†**: æ ‡å‡†åŒ–çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### æ€§èƒ½ä¼˜åŒ–
- **ç¼“å­˜æœºåˆ¶**: æ™ºèƒ½ç¼“å­˜æå‡å“åº”é€Ÿåº¦
- **æ‰¹é‡å¤„ç†**: é«˜æ•ˆçš„æ‰¹é‡æ•°æ®æ“ä½œ
- **æ€§èƒ½ç›‘æ§**: å®æ—¶æ€§èƒ½æŒ‡æ ‡å’Œç»Ÿè®¡
- **å¹¶å‘æ§åˆ¶**: åˆç†çš„å¹¶å‘è¯·æ±‚ç®¡ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…æ€æºç¬”è®°
1. ä¸‹è½½å®‰è£…åŒ…ï¼š[https://github.com/siyuan-note/siyuan/releases](https://github.com/siyuan-note/siyuan/releases)
2. å¯åŠ¨æ€æºç¬”è®°

### 2. é…ç½®æ€æºç¬”è®°
1. å¯åŠ¨æ€æºç¬”è®°
2. è®¾ç½® â†’ å…³äº â†’ API token
3. å¤åˆ¶API Token

### 3. å®‰è£… MCP Server

#### ä» npm å®‰è£…
```bash
npm install -g siyuan-mcp-server
```

#### ä»æºç å®‰è£…
```bash
git clone https://github.com/your-username/siyuan-mcp-server.git
cd siyuan-mcp-server
npm install
npm run build
npm link
```

### 4. é…ç½® MCP

åœ¨æ‚¨çš„ MCP å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```json
{
  "mcpServers": {
    "siyuan": {
      "command": "npx",
      "args": ["siyuan-mcp-server"],
      "env": {
        "SIYUAN_API_TOKEN": "your-api-token",
        "SIYUAN_API_URL": "http://127.0.0.1:6806"
      }
    }
  }
}
```

### 5. ç¯å¢ƒå˜é‡

- `SIYUAN_API_TOKEN`: æ€æºç¬”è®° API Tokenï¼ˆå¿…éœ€ï¼‰
- `SIYUAN_API_URL`: æ€æºç¬”è®° API åœ°å€ï¼ˆé»˜è®¤ï¼šhttp://127.0.0.1:6806ï¼‰(å¯é€‰,ä¸€èˆ¬æƒ…å†µä¼šè‡ªåŠ¨è·å–)

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **è¿è¡Œæ—¶**: Node.js 18+
- **è¯­è¨€**: TypeScript
- **åè®®**: Model Context Protocol (MCP)
- **HTTPå®¢æˆ·ç«¯**: Axios
- **æ„å»ºå·¥å…·**: TypeScript Compiler

## ğŸ“¡ MCP å·¥å…·åˆ—è¡¨

### ğŸ“š ç¬”è®°æœ¬æ“ä½œ (Notebook)
- `list_notebooks` - åˆ—å‡ºæ‰€æœ‰ç¬”è®°æœ¬
- `open_notebook` - æ‰“å¼€ç¬”è®°æœ¬
- `close_notebook` - å…³é—­ç¬”è®°æœ¬
- `rename_notebook` - é‡å‘½åç¬”è®°æœ¬
- `remove_notebook` - åˆ é™¤ç¬”è®°æœ¬

### ğŸ“„ æ–‡æ¡£æ“ä½œ (Document)
- `create_document` - åˆ›å»ºæ–°æ–‡æ¡£
- `get_document` - è·å–æ–‡æ¡£å†…å®¹
- `update_document` - æ›´æ–°æ–‡æ¡£
- `delete_document` - åˆ é™¤æ–‡æ¡£
- `list_documents` - åˆ—å‡ºæ–‡æ¡£
- `batch_read_all` - æ‰¹é‡è¯»å–æ‰€æœ‰æ–‡æ¡£

### ğŸ§± å—æ“ä½œ (Block)
- `create_block` - åˆ›å»ºå—
- `get_block` - è·å–å—
- `update_block` - æ›´æ–°å—
- `delete_block` - åˆ é™¤å—
- `prepend_block` - åœ¨å—å‰æ’å…¥
- `append_block` - åœ¨å—åè¿½åŠ 
- `fold_block` - æŠ˜å å—
- `unfold_block` - å±•å¼€å—
- `transfer_block_ref` - è½¬ç§»å—å¼•ç”¨
- `set_block_attrs` - è®¾ç½®å—å±æ€§
- `get_block_attrs` - è·å–å—å±æ€§
- `batch_create_blocks` - æ‰¹é‡åˆ›å»ºå—
- `batch_update_blocks` - æ‰¹é‡æ›´æ–°å—
- `batch_delete_blocks` - æ‰¹é‡åˆ é™¤å—

### ğŸ” æœç´¢æ“ä½œ (Search)
- `simple_search` - ç®€å•æœç´¢
- `recursive_search` - é€’å½’æœç´¢
- `search_in_document` - åœ¨æ–‡æ¡£ä¸­æœç´¢

### ğŸ¨ æ¨¡æ¿æ“ä½œ (Template)
- `render_template` - æ¸²æŸ“æ¨¡æ¿
- `render_sprig_template` - æ¸²æŸ“Sprigæ¨¡æ¿

### ğŸ“¤ å¯¼å‡ºæ“ä½œ (Export)
- `export_markdown` - å¯¼å‡ºä¸ºMarkdown
- `export_file` - å¯¼å‡ºä¸ºæŒ‡å®šæ ¼å¼
- `export_expand` - å¯¼å‡ºä¸ºæ ‘çŠ¶ç»“æ„

### ğŸ–¼ï¸ èµ„æºæ“ä½œ (Assets)
- `upload_asset` - ä¸Šä¼ èµ„æºæ–‡ä»¶
- `list_assets` - åˆ—å‡ºèµ„æºæ–‡ä»¶
- `rename_asset` - é‡å‘½åèµ„æºæ–‡ä»¶
- `ocr_asset` - OCRè¯†åˆ«å›¾ç‰‡

### ğŸ’¾ SQLæŸ¥è¯¢ (SQL)
- `query_sql` - æ‰§è¡ŒSQLæŸ¥è¯¢

### ğŸ“ æ–‡ä»¶æ“ä½œ (File)
- `read_file` - è¯»å–æ–‡ä»¶
- `write_file` - å†™å…¥æ–‡ä»¶
- `delete_file` - åˆ é™¤æ–‡ä»¶
- `list_files` - åˆ—å‡ºæ–‡ä»¶

### â° ç³»ç»Ÿæ“ä½œ (System)
- `get_current_time` - è·å–å½“å‰çœŸå®æ—¶é—´

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºæ–‡æ¡£
```typescript
// åˆ›å»ºæ–°æ–‡æ¡£
await toolRegistry.execute('create_document', {
  notebook: 'notebook-id',
  path: '/path/to/document',
  title: 'æ–‡æ¡£æ ‡é¢˜',
  content: 'æ–‡æ¡£å†…å®¹'
});
```

### æœç´¢å†…å®¹
```typescript
// é€’å½’æœç´¢
await toolRegistry.execute('recursive_search', {
  query: 'å…³é”®è¯',
  notebook: 'notebook-id',
  maxDepth: 5
});
```

### æ‰¹é‡æ“ä½œ
```typescript
// æ‰¹é‡åˆ›å»ºå—
await toolRegistry.execute('batch_create_blocks', {
  requests: [
    { content: 'ç¬¬ä¸€ä¸ªå—' },
    { content: 'ç¬¬äºŒä¸ªå—' }
  ]
});
```

### è·å–æ—¶é—´
```typescript
// è·å–å½“å‰æ—¶é—´
await toolRegistry.execute('get_current_time', {
  format: 'iso',
  timezone: 'Asia/Shanghai'
});
```

### å¯¼å‡ºæ–‡æ¡£
```typescript
// å¯¼å‡ºä¸ºMarkdown
await toolRegistry.execute('export_markdown', {
  id: 'document-id'
});
```

## ğŸ”§ å¼€å‘

### æ„å»ºé¡¹ç›®
```bash
npm run build
```

### è¿è¡Œæµ‹è¯•
```bash
npm test
```

### ä»£ç æ£€æŸ¥
```bash
npm run lint
```

### ç±»å‹æ£€æŸ¥
```bash
npm run typecheck
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºæ”¹è¿›å»ºè®®ï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ€æºç¬”è®°å›¢é˜Ÿæä¾›ä¼˜ç§€çš„ç¬”è®°è½¯ä»¶å’Œ API æ”¯æŒã€‚

## ğŸ“® è”ç³»æ–¹å¼

- é—®é¢˜åé¦ˆ: [GitHub Issues](https://github.com/your-username/siyuan-mcp-server/issues)
- åŠŸèƒ½å»ºè®®: [GitHub Discussions](https://github.com/your-username/siyuan-mcp-server/discussions)